{% extends "layout.html" %}
{% block content %}
<div class="mx-auto max-w-7xl">
    <!-- Header -->
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-2xl font-semibold text-slate-800">
                <i class="fa-solid fa-folder-open mr-2"></i> Document Management
            </h1>
            <p class="text-slate-600 text-sm">Securely store, share, and manage HR documents.</p>
        </div>
        <div class="flex items-center gap-2">
            <button id="uploadDocBtn" class="px-3 py-2 rounded-xl bg-slate-800 text-white hover:bg-slate-900 text-sm">
                <i class="fa-solid fa-upload mr-1"></i> Upload
            </button>
            <a href="{{ url_for('dashboard') }}"
                class="px-3 py-2 rounded-xl border border-slate-300 bg-white hover:bg-slate-50 text-sm">
                <i class="fa-solid fa-arrow-left mr-1"></i> Back
            </a>
        </div>
    </div>

    <!-- Tabs -->
    <div class="mb-6">
        <div class="flex space-x-1 bg-slate-100 p-1 rounded-xl">
            <button id="allDocsTab" class="dm-tab active px-4 py-2 rounded-lg text-sm font-medium"><i
                    class="fa-solid fa-file-alt mr-1"></i> All Documents</button>
            <button id="policiesTab" class="dm-tab px-4 py-2 rounded-lg text-sm font-medium"><i
                    class="fa-solid fa-scale-balanced mr-1"></i> Policies</button>
            <button id="contractsTab" class="dm-tab px-4 py-2 rounded-lg text-sm font-medium"><i
                    class="fa-solid fa-file-signature mr-1"></i> Contracts</button>
            <button id="confidentialTab" class="dm-tab px-4 py-2 rounded-lg text-sm font-medium"><i
                    class="fa-solid fa-user-lock mr-1"></i> Confidential</button>
            <button id="archivesTab" class="dm-tab px-4 py-2 rounded-lg text-sm font-medium"><i
                    class="fa-solid fa-box-archive mr-1"></i> Archives</button>
        </div>
    </div>

    <!-- All Documents -->
    <section id="allDocsPanel" class="dm-panel">
        <div class="rounded-2xl border border-slate-200 bg-white">
            <div class="flex items-center justify-between p-4 border-b border-slate-200">
                <div class="relative w-full md:w-96">
                    <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    <input id="searchDocs" placeholder="Search by title, type, or owner"
                        class="w-full pl-10 pr-10 py-2 rounded-xl border border-slate-300 focus:ring-2 focus:ring-slate-200">
                    <button id="clearSearch"
                        class="hidden absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                <div class="text-sm text-slate-600"><span id="docCount">0</span> documents</div>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm">
                    <thead class="text-left text-slate-500 border-b">
                        <tr>
                            <th class="py-2 px-4">Title</th>
                            <th class="py-2 px-4">Type</th>
                            <th class="py-2 px-4">Owner</th>
                            <th class="py-2 px-4">Last Modified</th>
                            <th class="py-2 px-4">Status</th>
                            <th class="py-2 px-4 w-28"></th>
                        </tr>
                    </thead>
                    <tbody id="docRows" class="text-slate-800"><!-- injected --></tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Policies -->
    <section id="policiesPanel" class="dm-panel hidden">
        <div class="rounded-2xl border border-slate-200 bg-white p-6">
            <h3 class="text-lg font-semibold text-slate-800 mb-4"><i class="fa-solid fa-scale-balanced mr-2"></i>
                Company Policies</h3>
            <ul id="policyList" class="space-y-3 text-sm"><!-- injected --></ul>
        </div>
    </section>

    <!-- Contracts -->
    <section id="contractsPanel" class="dm-panel hidden">
        <div class="rounded-2xl border border-slate-200 bg-white p-6">
            <h3 class="text-lg font-semibold text-slate-800 mb-4"><i class="fa-solid fa-file-signature mr-2"></i>
                Contracts</h3>
            <ul id="contractList" class="space-y-3 text-sm"><!-- injected --></ul>
        </div>
    </section>

    <!-- Confidential -->
    <section id="confidentialPanel" class="dm-panel hidden">
        <div class="rounded-2xl border border-slate-200 bg-white p-6">
            <h3 class="text-lg font-semibold text-slate-800 mb-4"><i class="fa-solid fa-user-lock mr-2"></i>
                Confidential Docs</h3>
            <ul id="confidentialList" class="space-y-3 text-sm"><!-- injected --></ul>
        </div>
    </section>

    <!-- Archives -->
    <section id="archivesPanel" class="dm-panel hidden">
        <div class="rounded-2xl border border-slate-200 bg-white p-6">
            <h3 class="text-lg font-semibold text-slate-800 mb-4"><i class="fa-solid fa-box-archive mr-2"></i> Archives
            </h3>
            <ul id="archiveList" class="space-y-3 text-sm"><!-- injected --></ul>
        </div>
    </section>
</div>

<script>
    /* ------------ Mock Data ------------ */
    let DOCS = [
        { id: 1, title: "Employee Handbook", type: "Policy", owner: "HR", last: "2025-09-01", status: "Active" },
        { id: 2, title: "NDA - John Doe", type: "Contract", owner: "Legal", last: "2025-08-18", status: "Signed" },
        { id: 3, title: "Salary Records", type: "Confidential", owner: "Finance", last: "2025-08-25", status: "Restricted" },
        { id: 4, title: "Work From Home Policy", type: "Policy", owner: "HR", last: "2025-07-15", status: "Active" },
        { id: 5, title: "Former Employee Files", type: "Archive", owner: "HR", last: "2024-12-31", status: "Archived" }
    ];

    /* ------------ Elements & Init ------------ */
    const $ = (id) => document.getElementById(id);
    document.addEventListener('DOMContentLoaded', () => {
        // Tabs
        document.querySelectorAll('.dm-tab').forEach(b => {
            b.addEventListener('click', (e) => {
                document.querySelectorAll('.dm-tab').forEach(x => x.classList.remove('active'));
                e.currentTarget.classList.add('active');
                const name = e.currentTarget.id.replace('Tab', '');
                document.querySelectorAll('.dm-panel').forEach(p => p.classList.add('hidden'));
                document.getElementById(name + 'Panel').classList.remove('hidden');
            });
        });

        // Search
        const s = $('searchDocs'), clr = $('clearSearch');
        s.addEventListener('input', () => { clr.classList.toggle('hidden', !s.value.trim()); renderDocs(); });
        clr.addEventListener('click', () => { s.value = ''; clr.classList.add('hidden'); renderDocs(); });

        // Upload
        $('uploadDocBtn').addEventListener('click', () => alert('ðŸ“‚ Upload modal would appear here'));

        // Initial renders
        renderDocs(); renderLists();
    });

    /* ------------ All Docs ------------ */
    function renderDocs() {
        const q = ($('searchDocs').value || '').toLowerCase();
        const data = DOCS.filter(d => !q || d.title.toLowerCase().includes(q) || d.type.toLowerCase().includes(q) || d.owner.toLowerCase().includes(q));
        $('docCount').textContent = data.length;
        $('docRows').innerHTML = data.map(d => {
            const pill = d.status === 'Active' ? 'bg-emerald-50 text-emerald-700' :
                d.status === 'Signed' ? 'bg-blue-50 text-blue-700' :
                    d.status === 'Restricted' ? 'bg-red-50 text-red-700' :
                        'bg-slate-100 text-slate-700';
            return `
      <tr class="border-b last:border-0">
        <td class="py-2 px-4 font-medium">${d.title}</td>
        <td class="py-2 px-4">${d.type}</td>
        <td class="py-2 px-4">${d.owner}</td>
        <td class="py-2 px-4">${d.last}</td>
        <td class="py-2 px-4"><span class="px-2 py-0.5 rounded-full text-xs ${pill}">${d.status}</span></td>
        <td class="py-2 px-4 text-right">
          <button class="px-2 py-1 rounded border border-slate-300 bg-white text-xs hover:bg-slate-50" onclick="alert('Previewing ${d.title}')"><i class="fa-solid fa-eye mr-1"></i> View</button>
        </td>
      </tr>
    `;
        }).join('') || `<tr><td colspan="6" class="py-6 text-center text-slate-500">No documents</td></tr>`;
    }

    /* ------------ Category Lists ------------ */
    function renderLists() {
        $('policyList').innerHTML = DOCS.filter(d => d.type === 'Policy').map(docItem).join('') || `<li class="text-slate-500">No policies</li>`;
        $('contractList').innerHTML = DOCS.filter(d => d.type === 'Contract').map(docItem).join('') || `<li class="text-slate-500">No contracts</li>`;
        $('confidentialList').innerHTML = DOCS.filter(d => d.type === 'Confidential').map(docItem).join('') || `<li class="text-slate-500">No confidential docs</li>`;
        $('archiveList').innerHTML = DOCS.filter(d => d.type === 'Archive').map(docItem).join('') || `<li class="text-slate-500">No archives</li>`;
    }

    function docItem(d) {
        return `
    <li class="flex items-center justify-between p-3 rounded-lg bg-slate-50">
      <div>
        <div class="font-medium text-slate-800">${d.title}</div>
        <div class="text-xs text-slate-600">${d.owner} â€¢ ${d.last}</div>
      </div>
      <button class="px-2 py-1 rounded border border-slate-300 bg-white text-xs hover:bg-slate-50" onclick="alert('Opening ${d.title}')"><i class="fa-solid fa-eye mr-1"></i> Open</button>
    </li>
  `;
    }
</script>

<style>
    .dm-tab.active {
        background-color: #1e293b;
        color: white;
    }

    .dm-tab:not(.active) {
        color: #64748b;
    }

    .dm-tab:not(.active):hover {
        background-color: #f1f5f9;
        color: #334155;
    }
</style>
{% endblock %}